{% extends 'base.html.twig' %}

{% block title %}AI Odpoveď{% endblock %}

{% block body %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            {# Tvoja otázka #}
            <div class="card shadow mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-person-fill"></i> Tvoja otázka
                    </h5>
                </div>
                <div class="card-body">
                    <p class="mb-0">{{ question }}</p>
                </div>
            </div>

            {# AI Odpoveď #}
            <div class="card shadow mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="bi bi-robot"></i> AI Odpoveď
                    </h5>
                </div>
                <div class="card-body">
                    <div class="ai-response">
                        {{ answer|nl2br }}
                    </div>
                </div>
            </div>

            {# Akcie #}
            <div class="d-grid gap-2">
                <button id="save-chat-btn" class="btn btn-success btn-lg">
                    <i class="bi bi-floppy"></i> Uložiť túto konverzáciu
                </button>
                
                <a href="{{ path('ai_chatbot') }}" class="btn btn-primary">
                    <i class="bi bi-arrow-left"></i> Nová otázka
                </a>
            </div>
        </div>
    </div>
</div>

<style>
.ai-response {
    font-size: 1.1rem;
    line-height: 1.6;
    white-space: pre-wrap;
}
</style>

<script>
async function saveChat() {
    const question = {{ question|json_encode|raw }};
    const answer = {{ answer|json_encode|raw }};
    
    try {
        const response = await fetch('/api/chats', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                title: question.substring(0, 50) + (question.length > 50 ? '...' : ''),
                messages: [
                    { role: 'user', content: question },
                    { role: 'assistant', content: answer }
                ]
            })
        });

        const data = await response.json();

        if (data.success) {
            alert('✅ Chat bol úspešne uložený!');
            document.getElementById('save-chat-btn').disabled = true;
            document.getElementById('save-chat-btn').textContent = '✅ Uložené';
        } else {
            alert('❌ Chyba: ' + data.error);
        }
    } catch (error) {
        alert('❌ Chyba: ' + error.message);
    }
}

document.getElementById('save-chat-btn').addEventListener('click', saveChat);
</script>
{% endblock %}